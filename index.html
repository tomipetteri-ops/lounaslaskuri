<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Paula & Tomi</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: white;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            font-family: 'Courier New', Courier, monospace;
        }

        /* Iframe täyttää koko ruudun */
        #dia-kehys {
            width: 100vw;
            height: 100vh;
            border: none;
            display: block;
        }

        /* Edistymispalkki alareunassa */
        #edistymispalkki {
            position: fixed;
            bottom: 0;
            left: 0;
            height: 4px;
            background: black;
            z-index: 100;
            transition: none;
        }
    </style>
</head>
<body>

    <iframe id="dia-kehys" src="laskuri.html"></iframe>
    <div id="edistymispalkki" style="width:0%"></div>

    <script>
        // ==========================================
        //  ASETUKSET — muuta näitä
        // ==========================================
        const DIAT = [
            { tiedosto: 'laskuri.html', aika: 5 },  // sekuntia
            { tiedosto: 'kuvat.html',   aika: 5 },
            { tiedosto: 'goals.html',   aika: 5 },
        ];
        // ==========================================

        let nykyinenDia = 0;
        let ajastin = null;

        function naytaDia(indeksi) {
            nykyinenDia = indeksi % DIAT.length;
            const dia = DIAT[nykyinenDia];

            // Vaihda iframe
            document.getElementById('dia-kehys').src = dia.tiedosto;

            // Edistymispalkki
            const palkki = document.getElementById('edistymispalkki');
            palkki.style.transition = 'none';
            palkki.style.width = '0%';
            setTimeout(() => {
                palkki.style.transition = 'width ' + dia.aika + 's linear';
                palkki.style.width = '100%';
            }, 50);

            // Ajastin seuraavaan diaan
            clearTimeout(ajastin);
            ajastin = setTimeout(() => naytaDia(nykyinenDia + 1), dia.aika * 1000);
        }

        // Käynnistys
        window.onload = () => naytaDia(0);

        // Kuuntele goals.html:n pysäytysviesti
        window.addEventListener('message', function(e) {
            if (e.data === 'pysayta') {
                clearTimeout(ajastin);
                // Pysäytä edistymispalkki
                const palkki = document.getElementById('edistymispalkki');
                const leveys = palkki.getBoundingClientRect().width / window.innerWidth * 100;
                palkki.style.transition = 'none';
                palkki.style.width = leveys + '%';
            } else if (e.data === 'kaynnista') {
                // Jatka diaesitystä seuraavasta diasta
                naytaDia(nykyinenDia + 1);
            } else if (e.data.type === 'kuvienAika') {
                // Etsi kuvat.html dia ja päivitä sen aika
                const kuvatDiaIndex = DIAT.findIndex(dia => dia.tiedosto === 'kuvat.html');
                if (kuvatDiaIndex !== -1) {
                    DIAT[kuvatDiaIndex].aika = e.data.aika;
                    console.log(`Kuvat.html dian aika päivitetty: ${e.data.aika}s`);
                    // Jos kuvat.html on jo esillä, ÄLÄ kutsu naytaDia() – se lataisi iframen uudelleen
                    // ja katkaisisi kuvien kierron. Päivitä vain ajastin ja palkki.
                    if (nykyinenDia === kuvatDiaIndex) {
                        const dia = DIAT[kuvatDiaIndex];
                        const palkki = document.getElementById('edistymispalkki');
                        palkki.style.transition = 'none';
                        palkki.style.width = '0%';
                        setTimeout(() => {
                            palkki.style.transition = 'width ' + dia.aika + 's linear';
                            palkki.style.width = '100%';
                        }, 50);
                        clearTimeout(ajastin);
                        ajastin = setTimeout(() => naytaDia(nykyinenDia + 1), dia.aika * 1000);
                    }
                }
            }
        });

        // Fullscreen kun klikataan
        document.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(() => {});
            }
        });
    </script>
</body>
</html>
